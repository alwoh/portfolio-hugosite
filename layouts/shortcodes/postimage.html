{{ $image := $.Page.Resources.GetMatch (.Get 0) }}
{{ $needsRotation := (.Get 1) }}
{{ if eq $needsRotation  true }}
    {{ $image = $image.Process "r270" }}
{{ end }}
{{ $resizeParam := (print "resize " (.Get 3))}}
{{ $smallImage := $image.Process $resizeParam }}

<figure class="post-figure">    
    <a href="{{ $image.RelPermalink }}">
        {{ with $smallImage }}
        <img src="{{ .RelPermalink }}"
            width="{{ .Width }}" height="{{ .Height }}"
            alt="{{ $.Get 2 }}" />
        {{ end }}
    </a>
    <figcaption>{{ .Get 2 }}</figcaption>
</figure>


